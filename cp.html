<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Control Panel</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>
<script src="./js/functions.js" type="text/javascript"></script>
<script type="text/javascript">
	var newPos = null;
	function drag(ev) {
		ev.dataTransfer.setData("text", ev.target.id);
	}

	function drop(ev) {
		ev.preventDefault();
		var posId = parseInt(ev.dataTransfer.getData("text"));
		var data = document.getElementById(posId);
		var children = Array.from($('#listingJutsu').children());
		var targetPos = children.indexOf(ev.target.parentNode);
		newPos = targetPos;
		if(targetPos>children.indexOf(data))
		{
			
			ev.target.parentNode.after(data);
		}
		else
		{
			ev.target.parentNode.before(data);
		}
	}
	function dragEnd(ev)
	{
		var oldPos = parseInt(ev.target.id);
		moveJutsu(oldPos, newPos);
		populateJutsu();

		newPos = null;
	}
	function setJutsu(jutsu)
	{
		//jutsu = JSON.parse(jutsu);
		let jutsuID = jutsu["jutsu_id"];
		let jutsuName = jutsu["name"];
		let jutsuType = jutsu["jutsu_type"];
		let jutsuSeals;
		
		if (jutsuType == 'taijutsu')
		{
			jutsuSeals = jutsuID;
		}
		else
		{
			jutsuSeals = jutsu["hand_seals"];
		}
				
		$('#useType').val(jutsuType);
		$('#jutsuName').val(jutsuName);
		$('#sealNumbers').val(jutsuSeals);
	}
	function populateJutsu()
	{
		jutsuList = $.parseJSON(Cookies.get("jutsu"));
		$('#listingJutsu').empty();
		for(let i in jutsuList) { //Prints out visual table of jutsu's in array.
			var weaponID = (jutsuList[i].weaponID == undefined)? '' : jutsuList[i].weaponID;
			$('#listingJutsu').append("<tr draggable='true' ondragstart='drag(event)' ondragover='drop(event)' id=" + parseInt(i) + "><td>" + (parseInt(i) + 1) + "</td><td>" + jutsuList[i].jutsuName + "</td><td>" + jutsuList[i].jutsuType + "</td><td>" + jutsuList[i].jutsuSeals + "</td><td>" + weaponID + "</td><td>" + "<button data-id=" + parseInt(i) + " class='removeButton'>Remove</button></td></tr>");
		};
	}
	
</script>
<script type="module">
$(document).ready(async function() {
	const request = new Request('./sc_jutsu.json');
	const response = await fetch(request);
	const jutsuLibrary = await response.json();
	
	const request2 = new Request('./sc_weapons.json');
	const response2 = await fetch(request2);
	const weaponLibrary = await response2.json();
	
	for (let jutsu in jutsuLibrary)
	{
		let jutsuID = jutsuLibrary[jutsu]["jutsu_id"];
		let jutsuName = jutsuLibrary[jutsu]["name"];
		let jutsuType = jutsuLibrary[jutsu]["jutsu_type"];
		let jutsuRank = jutsuLibrary[jutsu]["rank"];
		let jutsuSeals;
		if (jutsuType == 'taijutsu')
		{
			jutsuSeals = jutsuID;
		}
		else
		{
			jutsuSeals = jutsuLibrary[jutsu]["hand_seals"];
		}
		$('#jutsuSearch').append("<tr>" + "<td>" + jutsuID + "</td>" + "<td>" + jutsuName + "</td>" + "<td>" + jutsuType + "</td><td>" + jutsuSeals + "</td><td>" + jutsuRank + "</td><td><button onclick='setJutsu(" + JSON.stringify(jutsuLibrary[jutsu]) + ");'>Add</button></td></tr>");
	}
	
	for (let weapon in weaponLibrary)
	{
		$('#weaponList').append("<tr>" +  "<td>" + weaponLibrary[weapon]['item_id'] + "</td><td>" + weaponLibrary[weapon]['name'] + "</td><td>" + weaponLibrary[weapon]['rank'] + "</td><td>" + weaponLibrary[weapon]['effect'] + "</td></tr>");
	}

	$('#addButton').click(function() { //When clicked calls addJutsu with input values.
		addJutsu($('#useType').val(),$('#jutsuName').val(),$('#sealNumbers').val(),$('#weaponID').val());
		location.reload();
		top.frames['toolBar'].location.reload();
	});
	$('.removeButton').click(function (){
		clearJutsu();
		location.reload();
		top.frames['toolBar'].location.reload();
	});
	$('#clearButton').click(function (e) {
		e.preventDefault();
		$('#useType').val('');
		$('#jutsuName').val('');
		$('#sealNumbers').val('');
		$('#weaponID').val('')
	});
	$('#clearAllButton').click(function() { //When clicked calls clearJutsu function emptying array.
		clearJutsu();
		location.reload();
		top.frames['toolBar'].location.reload();
	});
	$('#jutsuSearchType').change(function () {
		let jutsuSearch = $('#jutsuSearch tr');
		jutsuSearch.splice(0,1);
		
		jutsuSearch.children().parent().css("display", "table-row");
		if (this.value == '') return;
		jutsuSearch.filter((index) => {
			return (jutsuSearch[index].children[2].innerText == this.value.toLowerCase()) == false;
		}).css("display", "none");
	});
	
	$('#jutsuSearchName').keyup(function () {
		let searchText = this.value;
		let jutsuSearch = $('#jutsuSearch tr');
		jutsuSearch.splice(0,1);
		
		jutsuSearch.children().parent().css("display", "table-row");
		
		jutsuSearch.filter((index) => {
			return jutsuSearch[index].children[1].innerText.toLowerCase().startsWith(searchText.toLowerCase()) == false;
		}).css("display", "none");
	});
	
	$('[name=hideButton]').click(function () {
		let jutsuSearchDiv = $('#jutsuSearch').parent();
		let weaponListDiv = $('#weaponList').parent();
		if ( this.value == 1)
		{
			
			if (jutsuSearchDiv.css('display') == 'block')
			{
				jutsuSearchDiv.hide();
			}
			else
			{
				jutsuSearchDiv.show();
				weaponListDiv.hide();
			}
		}
		else if (this.value == 2)
		{
			
			if (weaponListDiv.css('display') == 'block')
			{
				weaponListDiv.hide();
			}
			else
			{
				weaponListDiv.show();
				jutsuSearchDiv.hide();
			}
		}
		
	});

	if(Cookies.get("jutsu")) { // If cookie already exists pulls information into array.	
		populateJutsu();
	};
	
});
</script>
<style>
table {
	width: 40%;
	user-select: none;
	-moz-user-select: none;
}
table, tbody, th {
	border: solid 1px;
}
td {
	border-bottom: solid 1px;
	border-right: solid 1px;
	text-align: center;
}
a {
	padding: 5px;
	text-decoration: none;
}
</style>
</head>

<body>
<a href="https://shinobichronicles.com/" target="mainFrame"> Return to SC</a>
<br/>
<span>You can re-arrage the jutsu order by dragging and dropping the rows.</span>
<br/>
<span> For bloodline jutsu seal is: 0 - Genin, 1 - Chuunin, 2 - Jonin</span> 
<br />
<span> For Taijutsu use Jutsu ID, check link in jutsu page. </span>
<table ondragend="dragEnd(event)">
	<thead>
		<tr>
			<th>Key Number</th>
			<th>Jutsu Name</th>
			<th>Jutsu Type</th>
			<th>Jutsu Seals/ID</th>
			<th>Weapon ID</th>
		</tr>
	</thead>
	<tbody id="listingJutsu">
	</tbody>
</table>
<div>
	<form>
		<select id="useType">
			<option value="" selected>Select a style</option>
			<option value="ninjutsu">Ninjutsu</option>
			<option value="genjutsu">Genjutsu</option>
			<option value="taijutsu">Taijutsu</option>
			<option value="bloodline_jutsu">Bloodline</option>
		</select>
		<input type="text" value="" placeholder="name" id="jutsuName">
		<input type="text" value="" placeholder="Jutsu Seals or ID" id="sealNumbers">
		<input type="text" value="" placeholder="weapon id" id="weaponID">
		<button id="addButton">Submit</button>
		<button id="clearButton">Clear Input</button>
		<button id="clearAllButton">Clear All</button>
	</form>
<br/>
<button name="hideButton" value='1'>Toggle Jutsu List</button>
<button name="hideButton" value='2'>Toggle Weapon List</button>
<div style="display: none">
	<input type="text" value="" placeholder="name" id="jutsuSearchName">
	<select id="jutsuSearchType">
		<option value="" selected>Select a style</option>
		<option value="ninjutsu">Ninjutsu</option>
		<option value="genjutsu">Genjutsu</option>
		<option value="taijutsu">Taijutsu</option>
	</select>
	<table id="jutsuSearch">
		<tr>
			<th>Jutsu ID</th>
			<th>Jutsu Name</th>
			<th>Jutsu Type</th>
			<th>Jutsu Seals</th>
			<th>Jutsu Rank</th>
		</tr>
	</table>
</div>
	<div style="display: none">
	<table id="weaponList">
		<tr>
			<th>Weapon ID</th>
			<th>Weapon Name</th>
			<th>Weapon Rank</th>
			<th>Weapon Effect</th>
		</tr>
	</table>
	</div>
</div>
<div>
<table>
	<tr>
    	<td><p>Arrow Keys</p></td>
        <td><p>Travel</p></td>
    </tr>
	<tr>
		<td><p>Q</p></td>
		<td><p>Scout Area</p></td>
	</tr>
    <tr>
    	<td><p>W</p></td>
        <td><p>Training</p></td>
    </tr>
    <tr>
    	<td><p>E</p></td>
        <td><p>Travel Map</p></td>
    </tr>
    <tr>
    	<td><p>A</p></td>
        <td><p>Arena</p></td>
    </tr>
    <tr>
    	<td><p>S</p></td>
        <td><p>Ramen Shop</p></td>
    </tr>
    <tr>
    	<td><p>D</p></td>
        <td><p>Missions</p></td>
    </tr>
    <tr>
    	<td><p>Z</p></td>
        <td><p>Special Missions</p></td>
    </tr>
    <tr>
    	<td><p>X</p></td>
        <td><p>Profile</p></td>
    </tr>
	 <tr>
    	<td><p>C</p></td>
        <td><p>Chat</p></td>
    </tr>
	<tr>
    	<td><p>Space Bar</p></td>
        <td><p>Fight Selected AI</p></td>
    </tr>
	<tr>
    	<td><p>R</p></td>
		<td><p>Repeat Previous Training</p></td>
    </tr>
	<tr>
    	<td><p>F</p></td>
		<td><p>Repeat Previous Mission</p></td>
    </tr>
    <tr>
    	<td><p>Standard 1-6 or Number pad 1-6</p></td>
        <td><p>Use Set Jutsu In Order From Top To Bottom. Make sure to check the Spar/PVP boxes if that's what you are fighting.</p></td>
    </tr>
	<tr>
    	<td><p>Standard 7-9 or Number pad 7-9</p></td>
        <td><p>Consume food from the ramen shop. 7 - Vegetable ¥20, 8 - Pork ¥80, 9 - Deluxe ¥160</p></td>
    </tr>
</table>
<br/>
<a href="https://shinobichronicles.com/" target="mainFrame"> Return to SC</a>
</div>
</body>
</html>
